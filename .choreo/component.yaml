# Choreo component configuration
version: 1.0.0
type: service
name: facial-feature-extractor-api
description: "A FastAPI service for extracting facial landmarks from images using dlib"

buildPack: docker

build:
  env:
    # Build-time environment variables
    - name: PYTHON_VERSION
      value: "3.10"

deploy:
  # Deployment configuration
  resources:
    cpu: 1.0
    memory: 2Gi
  
  # Container configuration
  container:
    port: 8000
    env:
      # Runtime environment variables
      - name: LOG_LEVEL
        value: "INFO"
      - name: RATE_LIMIT
        value: "100"
      - name: PROJECT_NAME
        value: "Facial Feature Extractor API"
      - name: API_V1_STR
        value: "/api/v1"
  
  # Health check configuration
  healthCheck:
    port: 8000
    path: /health
    initialDelaySeconds: 30
    periodSeconds: 15
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
  
  # Autoscaling configuration (optional)
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    metrics:
      cpu:
        targetAverageUtilization: 80

# API configuration (if exposing as a managed API)
api:
  basePath: /
  cors:
    enabled: true
    accessControlAllowOrigins:
      - "*"
    accessControlAllowCredentials: false
    accessControlAllowHeaders:
      - "authorization"
      - "content-type"
    accessControlAllowMethods:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "OPTIONS"

# Observability configuration
observability:
  metrics:
    enabled: true
  logging:
    enabled: true
  tracing:
    enabled: true
